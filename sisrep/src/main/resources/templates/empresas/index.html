<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="base/layout :: comum-header"></head>
<body class="sb-nav-fixed">
	<header th:replace="base/layout :: navbar"></header>

	<div id="layoutSidenav">
		<nav th:replace="base/layout :: menu"></nav>

		<div id="layoutSidenav_content">
			<main>
				<div class="container-fluid p-2">
					<div class="row">
						<div class="col-12">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a th:href="@{/home}">
									<i  class="fa-duotone fa-solid fa-house"></i> Dashboard</a></li>
									<li class="breadcrumb-item active">
									<i class="fa-duotone fa-solid fa-building"></i> Empresas</li>
								</ol>
							</nav>
						</div>
						<div class="col-12">

							<!-- Mensagem de Sucesso -->
							<div th:if="${msgOk}"
								class="alert alert-success alert-dismissible fade show"
								role="alert" id="successAlert">
								<i class="fa-duotone fa-solid fa-thumbs-up me-2"></i> <span
									th:text="${msgOk}"></span>
								<button type="button" class="btn-close" data-bs-dismiss="alert"
									aria-label="Close"></button>
							</div>

							<!-- Mensagem de Erro -->
							<div th:if="${msgErro}"
								class="alert alert-danger alert-dismissible fade show"
								role="alert" id="errorAlert">
								<i class="fa-duotone fa-solid fa-triangle-exclamation me-2"></i>
								<span th:text="${msgErro}"></span>
								<button type="button" class="btn-close" data-bs-dismiss="alert"
									aria-label="Close"></button>
							</div>
						</div>
						<div class="col-12">
							<div class="card">
								<div
									class="card-header card-header d-flex justify-content-between align-items-center fs-4 pr-custom-text  fw-semibold text-uppercase">
									Empresas
									<!-- <a th:href="@{/usuarios/usuario}"
										class="btn btn-outline-primary"> <i
										class="fa-duotone fa-solid fa-plus"></i> Novo
									</a> -->
									<a th:href="@{/empresas/empresa}" th:if="${isAdmin or isMaster }"
										class="btn btn-outline-primary"> <i
										class="fa-duotone fa-solid fa-plus"></i> Novo
									</a>



								</div>

								<div class="card-body">
									<div class="row">
										<div class="col-12">
											<!-- Fomr de busca -->
											<form th:action="@{/empresas}" method="get"
												class="row g-3 align-items-center">
												<!-- Campo de busca por nome -->
												<div class="col-md-6">
													<label class="form-label">Busca por Nome</label>
													<div class="input-group mb-3">

														<input type="text" class="form-control" th:value="${nome}"
															name="nome">
														<button class="btn btn-outline-primary input-group-text"
															type="submit">
															<i class="fa-duotone fa-regular fa-magnifying-glass"></i>
														</button>

													</div>
												</div>
												<div class="col-md-4">
													<label class="form-label">Busca por CNPJ</label>
													<div class="input-group mb-3">
														<input type="text" class="form-control"
															th:value="${cnpj}" name="cnpj">
														<button class="btn  btn-outline-primary input-group-text"
															type="submit">
															<i class="fa-duotone fa-regular fa-magnifying-glass"></i>
														</button>

													</div>
												</div>

												<div class="col-md-2">
													<label class="form-label">Itens por página</label>
													<div class="input-group mb-3">
														<select class="form-select" name="size"
															onchange="this.form.submit()">
															<option th:each="size : ${pageSizes}" th:value="${size}"
																th:text="${size} + ' itens'"
																th:selected="${size == pageSize}"></option>
														</select>
													</div>
												</div>


											</form>


										</div>
										<div class="col-12 border-bottom pb-3 mb-3"></div>


										<div class="col-12">
											<!-- TABELA  -->
											<div class="table-responsive">
												<table
													class="table table-striped table-sm table-hover border">
													<thead class="table-dark">
														<tr class="fs-6 pr-custom-text">
															<th class="text-center pr-th-borda-suave align-middle">
																<a
																th:href="@{/empresas(size=${pageSize}, page=0, sortField=idEmpresa, sortDirection=${sortField == 'idEmpresa' ? reverseSortDir : 'asc'})}">
																	ID <span th:if="${sortField == 'idEmpresa'}"> <i
																		th:class="${sortDirection == 'asc' ? 'fa-solid fa-arrow-up' : 'fa-solid fa-arrow-down'}"></i>
																</span>
															</a>
															</th>
															<th class="text-center pr-th-borda-suave align-middle">Nome</th>
															<th class="text-center pr-th-borda-suave align-middle">Cnpj</th>
															<th class="text-center pr-th-borda-suave align-middle">Cidade</th>
															<th class="text-center pr-th-borda-suave align-middle">Estado</th>
															<th class="text-center align-middle">Ações</th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="empresa : ${empresas}">
															<td class="align-middle text-center"
																th:text="${empresa.id}"></td>
															<td class="align-middle" th:text="${empresa.nome}"></td>
															<td class="align-middle" th:text="${empresa.cnpj}"></td>
															<td class="align-middle" th:text="${empresa.municipio.nome}"></td>
														    <td class="align-middle text-center" th:text="${empresa.municipio.estado.uf}"></td>
														
															<!-- Ações na tabela -->
															<td class="align-middle text-center">
																<!-- Editar (para admin da empresa ou master) -->
																<a
																th:href="@{/empresas/editar/{id}(id=${empresa.id})}"
																th:if="${isAdmin or isMaster}"
																class="btn btn-sm btn-outline-primary border-0"> <i
																	class="fas fa-edit"></i>
															</a>
															 <!-- Detalhes (todos podem ver) --> <a
																th:href="@{/empresa/detalhar/{id}(id=${empresa.id})}"
																class="btn btn-sm btn-outline-secondary border-0"> <i
																	class="fa-duotone fa-regular fa-square-info"></i>
															</a> <!-- Excluir (só para admin) --> <a
																th:href="@{/empreas/excluir/{id}(id=${empresa.id})}"
																th:if="${isAdmin or isMaster}"
																class="btn btn-sm btn-outline-danger border-0"
																onclick="return confirm('Tem certeza que deseja excluir?')">
																	<i class="fa-duotone fa-light fa-trash-can-list"></i>
															</a>
															</td>
														</tr>
													</tbody>


												</table>
											</div>
											<!-- fim table responsive -->

										</div>

									</div>



								</div>
								<!-- <div class="card-footer">RODAPE</div>-->
								<div
									class="card-footer d-flex justify-content-between align-items-center">
									<div class="text-muted small">
										Mostrando <span th:text="${currentPage * pageSize + 1}"></span>
										a <span
											th:text="${(currentPage + 1) * pageSize > pageResult.totalElements ? pageResult.totalElements : (currentPage + 1) * pageSize}"></span>
										de <span th:text="${pageResult.totalElements}"></span>
										registros
									</div>

									<nav aria-label="Page navigation">
										<ul class="pagination pagination-sm mb-0">
											<!-- Primeira página -->
											<li class="page-item"
												th:classappend="${currentPage == 0} ? 'disabled'"><a
												class="page-link"
												th:href="@{/empresas(size=${pageSize}, page=0, sortField=${sortField}, sortDirection=${sortDirection}, nome=${nome}, cnpj=${cnpj})}">
													<i class="fa-duotone fa-angles-left"></i>
											</a></li>

											<!-- Página anterior -->
											<li class="page-item"
												th:classappend="${currentPage == 0} ? 'disabled'"><a
												class="page-link"
												th:href="@{/empresas(size=${pageSize}, page=0, sortField=${sortField}, sortDirection=${sortDirection}, nome=${nome}, cnpj=${cnpj})}">
													<i class="fa-duotone fa-angle-left"></i>
											</a></li>

											<!-- Páginas numeradas -->
											<li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
												class="page-item"
												th:classappend="${i == currentPage} ? 'active'"><a
												class="page-link"
												th:href="@{/empresas(size=${pageSize}, page=0, sortField=${sortField}, sortDirection=${sortDirection}, nome=${nome}, cnpj=${cnpj})}"
												th:text="${i + 1}"></a></li>

											<!-- Próxima página -->
											<li class="page-item"
												th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
												<a class="page-link"
												th:href="@{/empresas(size=${pageSize}, page=0, sortField=${sortField}, sortDirection=${sortDirection}, nome=${nome}, cnpj=${cnpj})}">
													<i class="fa-duotone fa-angle-right"></i>
											</a>
											</li>

											<!-- Última página -->
											<li class="page-item"
												th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
												<a class="page-link"
												th:href="@{/empresas(size=${pageSize}, page=0, sortField=${sortField}, sortDirection=${sortDirection}, nome=${nome}, cnpj=${cnpj})}">
													<i class="fa-duotone fa-angles-right"></i>
											</a>
											</li>
										</ul>
									</nav>
								</div>
							</div>
						</div>

					</div>



				</div>
				<!--FINAL CONTAINER-->
			</main>
			<footer th:replace="base/layout :: footer"></footer>
		</div>
	</div>

	<div th:replace="base/layout :: body-scripts"></div>
</body>
</html>
